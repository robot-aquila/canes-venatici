Задача

Дано: Наборы инструментов с разных бирж. 
Надо:
 * Формировать события
   - Спред начальный
   - Спред максимальный
   - Спред на закрытии
   * Каждый спред характеризуется:
      1) Момент времени
      2) Цена и объем на бирже покупки
      3) Цена и объем на бирже продажи
 * При начале события отправлять уведомление
 * При окончании события отправлять уведомление
 * В любое время можно запросить текущие незавершенные события с отображением
 промежуточных результатов

-------------------------------------------------------------------------------
Что НЕ делаем в этой версии:

* В данной версии не рассматриваем работу с зеркальными парами (A/B и B/A), так
как они требуют более сложных манипуляций по расчету обратного курса в том числе
пересчет стаканов.
* В данной версии не рассматриваем возможность с тремя и более инструментами в
цепочке.
* Не учитываем комиссию с высокой точностью. Вместо этого используем некое
усредненное значение комиссии GENERAL_COMMISSION_RATE.
* Не учитываем глубину рынка (котировки глубже относительно bestBid/bestAsk).

-------------------------------------------------------------------------------
Подход

1) Разбить инструменты на пулы потенциальных кандидатов, между которыми арбитраж
возможен технически (все пары A/B на разных биржах с одинаковыми baseAsset и
quoteAsset)
2) Для каждого инструмента из пула существует N-1 потенциальных кандидатов для
арбитража, где N - количество в пуле. Поскольку для расчета потенциала имеет
значение два стакана, то выполнить предварительную подготовку инструментов
невозможно - нужно рассматривать каждую пару отдельно. Дальнейшие действия
триггерятся по приходу изменений в стакан какого либо инструмента из пула.
3) Нет необходимости рассматривать ситуацию с двух существующих позиций для
отдельного инструмента: с т.з. продажи и с т.з. покупки. Достаточно рассмотреть
только со стороны продажи, а противоположный кейс будет автоматически рассмотрен
при обработке антагониста.
4) Условия отбора для пары инструментов A и B:
    * Пара не должна быть на отслеживании. В данном контексте пара означает два
    эквивалентных инструмента на двух разных торговых площадках.
    * CurrentTime - min(A.lastUpdateTime, B.lastUpdateTime) < MAX_DELAY
    * (Spread = A.bestBid - B.bestAsk) > 0
    То есть на проверяемой бирже цена покупки (bid) инструмента д.б. выше цены
    продажи (ask) на противоположной. При таком раскладе в сделке есть ненулевой
    потенциал: мы можем купить на B по цене bestAsk и продать на A по цене bestBid.
    * Spread > (A.bestBid + B.bestAsk) * GENERAL_COMMISSION_RATE [* 2 ???TBD]
    Spread должен быть больше комиссии (необходимо включить кромиссию на закрытие
    при схлопывании спреда или на перевод между площадками). Сколько комиссии
    заплатим при закрытии зависит от того, в какую сторону пойдет цена.
    Если исходить из того, что спред схлопнется в пределах тех уровней, в которых
    он был открыт, то нужно просто удвоить комиссию. 

------- TODO ---- TODO ---- TODO ---- TODO ---- TODO ---- TODO ---- TODO ---- TODO ----

	
5) Полученные в результате фильтрации пары попадают в пул отслеживаемых.
И далее для каждой отслеживаемой пары при кажом изменении в стакане A или B:
    - Выполняется расчет спреда: Spread = B.bestAsk - A.bestBid
    - Если спред увеличился, то фиксируется значение и момент максимального
    потенциала от цены покупки.
    - Условием снятия с отслеживания является:
    Spread < (B.bestAsk + A.bestBid) * GENERAL_COMMISSION_RATE
    WARNING!!! Это НЕ рабочая схема для закрытия открытых позиций, при открытии
    рыночно-нейтральной позы. Это всего лишь упрощенный способ определения момента
    завершения. При %-ной комсе она должна быть учтена в момент открытия. И при %-ной
    комсе есть рыночный риск, если открыта рыночно нейтральная и цена A & B пойдет в
    рост, то комса пойдет расти. Значит на открытии надо закладывать не тупо
    COMMISSION_RATE x 2, а нечто более сложное с учетом текущей волатильности. А что бы
    посчитать волу, нужно знать стату по этим событиям, что мы здесь отслеживаем.
    Еще раз - это не финальное и рабочее условие выхода, а первичная реализация условия
    выхода.
После снятия с отслеживания пара инструментов становится доступной для отбора в п.4.

-------------------------------------------------------------------------------
Описание: Security (Инструмент)
Каждый инструмент характеризуется:
1) ticker - уникальная в рамках системы строка идентификатора инструмента.
Включает в себя символ (уникальный в рамках торговой площадки), идентификатор
биржи и идентификатор торговой площадки (опционально).
2) baseSymbol - строковый идентификатор базового актива (что торгуем)
3) quoteSymbol - строковый идентификатор валюты цены (чем расплачиваемся)

-------------------------------------------------------------------------------
Описание: MarketDepth (Стакан)
Стакан - это набор текущих котировок по инструменту, агрегированных по объему и
сгруппированных по цене. Каждая котировка характеризуется парой значений: ценой и
объемом. 
Характеристики стакана:
1) bids - котировки покупателей, отсортированные в порядке убывания цены
2) asks - котировки продавцов, отсортированные в порядке возрастания цены
3) lastUpdateTime - время последнего обновления данных стакана.
